openapi: 3.0.3
info:
  title: Payment Processing System API
  version: "1.0.0"
  description: REST API for payments, refunds, and subscriptions. Currency fixed to INR for v1.
servers:
  - url: /
paths:
  /v1/payments/purchase:
    post:
      summary: Purchase (auth+capture)
      operationId: purchase
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurchaseRequest'
            examples:
              ok:
                value:
                  orderId: order-123
                  amount: { amount: "10.00", currency: INR }
                  paymentToken: tok_opaque
      responses:
        '201':
          description: Created
          headers:
            X-Correlation-Id: { $ref: '#/components/headers/CorrelationId' }
            X-API-Version: { $ref: '#/components/headers/ApiVersion' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
              examples:
                created:
                  value:
                    id: order-123
                    amount: { amount: "10.00", currency: INR }
                    status: CAPTURED
                    createdAt: 2025-09-28T12:00:00Z
        '422': { $ref: '#/components/responses/Unprocessable' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '409': { $ref: '#/components/responses/Conflict' }
        '500': { $ref: '#/components/responses/ServerError' }
  /v1/payments/cancel:
    post:
      summary: Cancel (void) an authorization
      operationId: cancelAuthorization
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelRequest'
            examples:
              ok:
                value:
                  authorizationId: pi-order-123
      responses:
        '200':
          description: Voided
          headers:
            X-Correlation-Id: { $ref: '#/components/headers/CorrelationId' }
            X-API-Version: { $ref: '#/components/headers/ApiVersion' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelResponse'
              examples:
                ok:
                  value:
                    authorizationId: pi-order-123
                    status: CANCELED
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/Unprocessable' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '500': { $ref: '#/components/responses/ServerError' }
components:
  parameters:
    IdempotencyKey:
      name: X-Idempotency-Key
      in: header
      required: false
      schema: { type: string, maxLength: 200 }
      description: Idempotency key scoped per merchant and endpoint, TTL 24h.
  headers:
    CorrelationId:
      description: Correlation id for tracing
      schema: { type: string }
    ApiVersion:
      description: API version corresponding to this response
      schema: { type: string, example: v1 }
  responses:
    Unauthorized:
      description: Unauthorized
    Conflict:
      description: Conflict
    Unprocessable:
      description: Unprocessable entity
    ServerError:
      description: Server error
  schemas:
    Money:
      type: object
      required: [ amount, currency ]
      properties:
        amount: { type: string, pattern: "^\\d+\\.\\d{2}$" }
        currency: { type: string, enum: [ INR ] }
    PurchaseRequest:
      type: object
      required: [ orderId, amount, paymentToken ]
      properties:
        orderId: { type: string }
        amount: { $ref: '#/components/schemas/Money' }
        paymentToken: { type: string }
    CancelRequest:
      type: object
      required: [ authorizationId ]
      properties:
        authorizationId: { type: string }
    Payment:
      type: object
      required: [ id, amount, status, createdAt ]
      properties:
        id: { type: string }
        amount: { $ref: '#/components/schemas/Money' }
        status: { type: string, enum: [ CAPTURED, AUTHORIZED, CANCELED ] }
        createdAt: { type: string, format: date-time }
    CancelResponse:
      type: object
      required: [ authorizationId, status ]
      properties:
        authorizationId: { type: string }
        status: { type: string, enum: [ CANCELED ] }
